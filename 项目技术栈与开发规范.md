# 项目技术栈与开发规范 (AI Instructions)

## 1. 核心技术栈

以下是我们项目使用的核心技术栈。所有代码生成和技术方案都必须严格遵守此规范。

- **应用框架: Next.js 15+**
  - **角色**: 全栈Web框架。
  - **规范**:
    - **路由**: 严格使用 **App Router** (`/src/app` 目录结构)。
    - **组件**: 默认使用 **React Server Components (RSC)** 进行数据获取和后端逻辑处理。仅在需要交互性时（如 `onClick`, `useState`）使用 `'use client'` 声明客户端组件。
    - **数据交互**: 优先使用 **Server Actions** 处理表单提交和数据变更 (Mutations)。
- **UI & 样式**:
  - **组件库**: **shadcn/ui**
    - **角色**: 提供基础UI组件。
    - **规范**: 组件通过CLI安装到项目 `/src/components/ui` 目录中，可直接进行修改。
    - **参考**: https://www.shadcn.com.cn/docs/components/accordion
  - **CSS框架**: **Tailwind CSS**
    - **角色**: 用于所有样式定义。
    - **规范**: 采用原子化CSS类进行样式编写。避免使用原生CSS文件，除非用于全局基础样式定义 (`/src/app/globals.css`)。
- **AI 核心**: **Vercel AI SDK**
  - **角色**: 连接前端与大型语言模型 (LLM) API的桥梁。
  - **规范**:
    - 使用其提供的React Hooks (如 `useChat`, `useCompletion`) 在客户端组件中实现流式响应。
    - 在Server Actions或Route Handlers中调用其核心函数，与AI模型进行交互。
- **数据库**: **PostgreSQL (with `pgvector` extension)**
  - **角色**: 主数据库，用于存储结构化数据和向量数据。
  - **规范**: 必须启用并使用 `pgvector` 扩展来支持向量的存储和相似度搜索。
- **ORM**: **Prisma**
  - **角色**: 数据库访问层，提供类型安全的数据库操作。便于拓展。
  - **规范**:
    - **模型定义**: 唯一的真实数据源是 `/prisma/schema.prisma` 文件。所有数据模型必须在此文件中定义。
    - **工作流**:
      1. 修改 `schema.prisma` 文件。
      2. 本地开发运行 `npx prisma generate` 来更新Prisma Client类型。
      3. 本地开发运行 `npx prisma migrate dev` 来创建和应用数据库迁移。
    - **客户端实例**: 在 `/src/lib/prisma.ts` 中创建并导出一个单例的 `PrismaClient` 实例，以避免在开发环境中创建过多连接。
- **静态文件存储: 阿里云 OSS (S3 兼容)**
  - **角色**: 存储用户上传的图片、视频、文档等静态资源。
  - **规范**:
    - 应用后端通过 S3 兼容的SDK (例如 `@aws-sdk/client-s3`) 与 OSS 进行交互。
    - 客户端上传文件时，应通过后端获取预签名的上传URL (presigned URL) 来实现安全、直接的上传，避免文件流经服务器。
    - 数据库中只存储文件的 key 或 URL，不存储文件本身。

## 2. 项目结构与代码规范

- **语言**: **TypeScript** (启用 `strict` 模式，必须提醒AI编写时严禁使用ANY类型)。

- **主要目录结构**:

  ```
  /
  ├── prisma/
  │   └── schema.prisma      # 数据库模型定义
  ├── public/                # 静态资源
  └── src/
      ├── app/                 # Next.js 路由和页面
      │   ├── api/             # API Route Handlers
      │   └── (routes)/...     # 页面组件
      ├── components/
      │   ├── ui/              # shadcn/ui 官方组件
      │   └── shared/          # 项目自定义的、可复用的组件
      └── lib/
          ├── prisma.ts        # Prisma Client 单例
          ├── ai.ts            # AI SDK 相关配置和助手函数
          ├── oss.ts           # OSS/S3 客户端和相关函数
          └── utils.ts         # 通用工具函数
  ```

## 3. 请求AI协助时的示例格式

当我向你请求代码时，我会尽量遵循以下格式，请根据这些信息进行响应：

- **目标 (Goal)**: (简要说明我想实现的功能)
- **上下文 (Context)**: (说明此功能所在的具体文件或组件路径)
- **数据模型 (Data Models)**: (指出需要参考的 `prisma.schema` 中的模型)
- **具体请求 (Request)**: (详细说明需要你生成的代码片段、函数或完整组件)

## 4. 版本控制 (Version Control)

- **工具**: **Git**

  - **角色**: 项目代码的版本管理工具。
  - **规范**:
    - 所有代码变更都必须通过 Git 进行提交。
    - 遵循 [Conventional Commits](https://www.conventionalcommits.org/zh-hans/v1.0.0/) 规范编写提交信息，便于追溯和自动化处理。
    - 使用 `.gitignore` 文件忽略不需要版本控制的文件和目录。

- **.gitignore 文件内容**

  - **目的**: 确保本地环境变量、依赖目录、构建产物和系统/IDE临时文件不会被提交到代码仓库。

  ```
  # Dependencies
  /node_modules
  /.pnpm-store
  
  # Local Environment Variables (IMPORTANT!)
  .env
  .env.local
  .env.development.local
  .env.test.local
  .env.production.local
  
  # Next.js build output
  /.next/
  /out/
  
  # Production
  /build
  
  # Logs
  npm-debug.log*
  yarn-debug.log*
  yarn-error.log*
  pnpm-debug.log*
  
  # Editor directories and files
  .vscode/
  .idea/
  *.suo
  *.ntvs*
  *.njsproj
  *.sln
  *.sw?
  
  # macOS specific files
  .DS_Store
  ```