### **"AI健康运势手串"项目 技术选型表**

| 类别                  | 技术/服务                  | 推荐理由                                                                                                                                                                 |
| ------------------- | ---------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **全栈框架**            | **Next.js 15 (全栈)**    | 1. **前后端一体化**: 利用Next.js的App Router和API Routes，在单一框架内同时处理前端渲染和后端API逻辑，简化架构复杂度。 2. **极致性能**: React Server Components (RSC) + 服务端渲染，为目标用户群体提供极速体验。 3. **TypeScript原生支持**: 前后端共享类型定义，提升开发效率和代码质量。 |
| **UI 样式**           | **Tailwind CSS v4.0**  | 1. **前所未有的性能**: 全新的Lightning CSS引擎极大缩短项目构建时间，提升开发效率。 2. **更小的产出体积**: 优化后的引擎使得最终CSS文件体积更小，提升用户加载速度。                                                                   |
| **UI 组件库**          | **shadcn/ui**          | 1. **完全的自主权**: 将组件源码直接复制到项目中，可以进行任意修改，完美实现项目中独特的"东方禅意"设计理念。 2. **高可访问性**: 底层基于Radix UI构建，保证了组件对年长用户非常友好。                                                             |
| **数据库 (Database)**  | **PostgreSQL**         | 1. **稳定可靠**: 功能强大、高度可靠的开源关系型数据库。 2. **原生JSON支持**: 对存储AI返回的原始JSON数据非常友好，便于后续查询和分析。                                                                                    |
| **ORM**             | **Prisma**             | 1. **完美集成**: 与Next.js和TypeScript完美配合，提供完全类型安全的数据库访问。 2. **开发体验佳**: Schema定义直观，自动生成的客户端API可在前后端共享使用。 3. **边缘计算友好**: 支持连接池和边缘运行时，适合现代部署需求。                                    |
| **AI 服务**           | **通用RESTful AI接口**     | 1. **高度灵活性**: **系统不绑定任何特定AI供应商**。只需在后台配置AI服务的`端点(Endpoint)`、`密钥(Key)`和`模型名称(Model Name)`，即可无缝切换或接入不同的、兼容GPT模式的大语言模型。 2. **易于集成**: 后端逻辑将统一处理对该端点的POST请求，降低了对特定SDK的依赖。 |
| **定时任务**            | **node-cron**          | 1. **轻量级调度**: 纯JavaScript实现的cron任务调度器，无需额外系统依赖。 2. **灵活配置**: 支持标准cron表达式，可精确控制批量生成时间。 3. **内置集成**: 与Next.js应用完美集成，支持开关控制和手动触发。 4. **错误处理**: 内置重试机制和降级策略，确保服务稳定性。 |
| **认证机制**            | **NFC UID**            | 1. **无缝体验**: **NFC芯片的唯一ID (`nfc_uid`) 即是用户的唯一身份凭证**，无需注册、登录、密码等任何传统认证流程，最大限度降低了目标用户的使用门槛。                                                                            |
| **部署 (Deployment)** | **自有服务器 + PM2**       | 1. **完全控制**: **前后端代码在同一个Next.js项目中，部署到自有服务器**，拥有完全的环境控制权。 2. **进程管理**: PM2提供进程守护、负载均衡、日志管理等功能。 3. **成本可控**: 固定服务器成本，不受流量波动影响。 4. **数据安全**: 所有数据存储在自有服务器，确保数据安全和隐私保护。 |
| **NFC 交互**          | **参数接收**               | 1. **职责分离**: **项目不涉及任何NFC硬件或协议层面的开发**。前端应用仅负责从URL中接收并处理由手机NFC功能传递过来的`nfc_uid`参数。                                                                                     |

---

### **文档一：“AI健康运势手串”项目核心需求**

**1. 产品目标与核心价值**

- **目标：** 为保健品品牌打造一个创新的客户关怀与互动工具。核心是通过每日的“健康运势”，以一种新颖、关怀的方式，向目标用户群体（年纪稍长者）传递健康生活理念，从而增强品牌粘性与信赖感。
    
- **核心价值：**
    
    - **对用户：** 每日获得一份专属的、有温度的健康提醒与建议，满足他们对健康和好运的关注。
        
    - **对公司：**
        
        1. **强化品牌定位：** 巩固品牌在健康领域的专业形象。
            
        2. **提升用户粘性：** 将一次性的产品购买关系，转变为每日的情感互动关系。
            
        3. **精准内容触达：** 以“运势”为包装，温和地进行健康教育和品牌理念渗透。
            

**2. 核心用户流程**

- **场景一：首次使用与信息绑定流程**
    
    1. **用户**：用手机首次触碰NFC手串。
        
    2. **系统**：手机浏览器自动打开指定网页（URL中已包含NFC唯一ID）。
        
    3. **系统**：后台判断该ID未绑定，展现“信息输入界面”。
        
    4. **用户**：输入姓名、性别、出生日期、出生地点并提交。
        
    5. **系统**：保存用户资料，并与该ID进行绑定。
        
    6. **系统**：绑定成功后，立即生成并展示当天的运势内容。
        
-- **场景二：日常查看运势流程（已绑定后）**
    
    1. **用户**：再次用手机触碰NFC手串。
        
    2. **系统**：手机浏览器自动打开网页。
        
    3. **系统**：后台识别ID，确认为已绑定用户。
        
    4. **系统**：根据当前运势生成模式展示运势：
       - **按需模式（默认）**：检查当日运势是否存在，如不存在则实时生成后展示
       - **定时模式**：直接展示预生成的当日运势数据
        

**3. 功能需求拆解**

- **前端界面**
    
    - **信息输入页：** 包含姓名、性别、出生日期、出生地点四个输入字段及提交按钮。
        
    - **运势反馈页：** 清晰展示六大模块：整体运势（星星⭐）、健康运势（大篇幅+建议）、财富运势、人际运势、幸运色、行动建议。
        
- **后端逻辑**
    
    - **NFC用户绑定：** 实现NFC唯一ID与用户个人信息的一对一绑定。
        
    - **运势生成管理：** 支持双模式运势生成（按需生成为默认，定时批量生成可选），用户访问时检查当日运势是否存在，如不存在则根据当前模式进行生成，并将返回结果解析、结构化存入数据库。
        
    - **运势信息读取：** 提供接口，能在用户访问时，根据NFC ID快速返回当天运势数据。
        

**4. 关键点与解决方案：异常情况处理**

- **情况一：用户网络不佳**
    
    - **提示文案：** “哎呀，与宇宙的连接好像断开了…请检查一下您的网络，稍后重试，好运正在等待您。”
        
    - **界面交互：** 提供【点击重试】按钮，方便用户快速刷新。
        
- **情况二：后端AI服务故障（运势未生成）**
    
    - **提示文案：** “AI大师正在为您精心推算今日运势…美好的事物值得等待，请您稍后再次碰一碰手串，也许惊喜就在下一秒。”
        
    - **界面交互：** 不提供重试按钮，通过文案引导用户稍后再次尝试。
        

---

### **文档二："AI健康运势手串"项目 详细技术需求规格说明 (修订版)**

**1. 数据模型/数据库设计 (Database Schema)**

_数据库：PostgreSQL_

**表1：users (用户信息表)**

|字段名|类型|约束|描述|
|---|---|---|---|
|id|INTEGER|PRIMARY KEY, AUTO_INCREMENT|用户唯一ID|
|nfc_uid|VARCHAR(255)|UNIQUE, NOT NULL|NFC芯片的唯一标识符，作为用户认证凭证|
|name|VARCHAR(100)|NOT NULL|用户姓名|
|gender|VARCHAR(10)|NULL|性别|
|date_of_birth|DATE|NOT NULL|出生日期 (YYYY-MM-DD)|
|birth_place|VARCHAR(255)|NULL|出生地点|
|created_at|TIMESTAMP|DEFAULT CURRENT_TIMESTAMP|创建时间|
|updated_at|TIMESTAMP|DEFAULT CURRENT_TIMESTAMP|更新时间|

**表2：fortunes (每日运势表)**

|字段名|类型|约束|描述|
|---|---|---|---|
|id|INTEGER|PRIMARY KEY, AUTO_INCREMENT|运势记录ID|
|user_id|INTEGER|FOREIGN KEY (users.id)|关联的用户ID|
|fortune_date|DATE|NOT NULL|运势对应的日期|
|overall_rating|INTEGER|NOT NULL|整体运势（1-5颗星）|
|health_fortune|TEXT|NOT NULL|健康运势的详细文本|
|health_suggestion|TEXT|NOT NULL|健康建议|
|wealth_fortune|TEXT|NOT NULL|财富运势|
|interpersonal_fortune|TEXT|NOT NULL|人际运势|
|lucky_color|VARCHAR(50)|NOT NULL|幸运色|
|action_suggestion|TEXT|NOT NULL|行动建议|
|raw_ai_response|JSON|NULL|AI返回的原始JSON，用于调试|
|created_at|TIMESTAMP|DEFAULT CURRENT_TIMESTAMP|创建时间|

- **约束:** 在 `fortunes` 表上应建立 `(user_id, fortune_date)` 的联合唯一索引，确保一个用户一天只有一条运势记录。
    

**2. 后端API接口定义 (API Routes)**

_基础路径为 `/api`，使用Next.js API Routes实现_

**API Route 1: 检查状态与获取运势**

- **文件路径:** `app/api/fortune/[nfc_uid]/route.ts`
    
- **HTTP方法:** `GET`
    
- **描述:** 用户通过NFC触碰后，前端调用的核心接口。`nfc_uid`直接从动态路由参数中获取。系统会检查当日运势是否存在，如不存在则实时生成。
    
- **响应状态:**
    
    - **200 OK:** 成功获取或生成运势。
        
    - **404 Not Found (Custom Code `NEEDS_REGISTRATION`):** NFC UID未注册。
        
    - **500 Internal Server Error:** AI服务调用失败或其他系统错误。
        

**API Route 2: 创建/注册新用户**

- **文件路径:** `app/api/users/route.ts`
    
- **HTTP方法:** `POST`
    
- **描述:** 提交新用户信息以完成注册和绑定。
    
- **请求体 (Request Body):** `{"nfc_uid": "...", "name": "...", "gender": "...", "date_of_birth": "...", "birth_place": "..."}`
    
- **成功响应 (201 Created):** 创建用户成功，并立即生成并返回当日运势。
    
- **失败响应 (422 Unprocessable Entity):** 数据验证失败。

**3. 核心业务逻辑**

**运势生成模式控制**

系统支持两种运势生成模式，通过管理后台开关控制：

**模式一：按需运势生成 (实时AI调用) - 默认模式**

- **触发时机:** 用户通过NFC访问时，如果当日运势不存在则实时生成
- **生成策略:** 每个用户每天只生成一次，避免重复调用AI接口

**模式二：定时批量生成 (每日凌晨为所有用户生成)**

- **触发时机:** 每日凌晨2:00自动为所有已注册用户生成当日运势
- **访问策略:** 用户访问时直接返回预生成的运势数据，响应更快
- **降级机制:** 如某用户运势生成失败，自动降级为按需生成模式

**统一执行流程:**
    
    1. **用户访问检测**: 当用户通过NFC访问时，API Route首先检查当日运势是否已存在
        
    2. **缓存检查**: 使用Prisma查询数据库，检查该用户当天的运势记录
        
    3. **按需生成**: 如果当日运势不存在，则实时调用AI服务生成
        
    4. 从环境变量中读取AI服务的`端点(Endpoint)`、`密钥(Key)`和`模型名称(Model Name)`
        
    5. 根据用户信息构建结构化的AI Prompt
        
    6. **调用通用AI接口**: 向配置的`端点`发送携带`密钥`的POST请求，请求体包含`模型名称`和Prompt
        
    7. **解析与存储**: 验证返回的JSON格式，使用**Prisma Client**将解析后的数据存入 `fortunes` 表
        
    8. **返回结果**: 将生成的运势数据返回给前端展示
        
    9. **错误处理**: 记录生成失败的错误日志，提供友好的错误提示

**B. 前后端数据流 (全栈一体化 + 自有服务器)**

- **类型安全**: 使用TypeScript在前后端共享数据类型定义
    
- **Server Components**: 利用React Server Components直接在服务端查询数据库
    
- **API Routes**: 处理客户端交互和AI服务调用
    
- **数据库连接**: 通过Prisma统一管理数据库连接和查询，连接到自有服务器的PostgreSQL数据库
    
- **按需生成**: 实时响应用户请求，避免资源浪费

---

**4. 关键点与解决方案：异常情况处理**

- **情况一：用户网络不佳**
    
    - **提示文案：** “哎呀，与宇宙的连接好像断开了…请检查一下您的网络，稍后重试，好运正在等待您。”
        
    - **界面交互：** 提供【点击重试】按钮，方便用户快速刷新。
        
- **情况二：后端AI服务故障（运势未生成）**
    
    - **提示文案：** “AI大师正在为您精心推算今日运势…美好的事物值得等待，请您稍后再次碰一碰手串，也许惊喜就在下一秒。”
        
    - **界面交互：** 不提供重试按钮，通过文案引导用户稍后再次尝试。
        

---

### **文档三：UI设计规范与用户体验**

**1. 字体排版 (Typography)**

- **中文字体：** 使用项目内置的 `霞鹜文楷 (LXGW WenKai)` 字体系列，提供温暖、人文的阅读体验
  - 常规文本：`LXGWWenKai-Regular.ttf`
  - 重要标题：`LXGWWenKai-Medium.ttf`
  - 轻量文本：`LXGWWenKai-Light.ttf`
  - 等宽代码：`LXGWWenKaiMono-Regular.ttf`（用于数字显示）
    
- **字体文件路径：** `/public/fonts/` 目录下包含完整的霞鹜文楷字体系列
    
- **英文/数字：** 霞鹜文楷内置优秀的英文字符，无需额外配置
    
- **字号层级：** 
  - 标题：24px-32px
  - 正文：16px-18px  
  - 辅助信息：14px
  - 注释：12px

**2. 布局与元素 (Layout & Elements)**

- **卡片式布局：** 将每一项运势封装在独立的卡片中，留有足够的间距（留白）。
    
- **圆角设计：** 按钮、卡片等元素使用较大的圆角（8px-12px），营造柔和、安全的感受。
    
- **大按钮：** 所有可点击的按钮区域要足够大，易于点按。

**3. 图标与插画 (Icons & Illustrations)**

- **风格：** 推荐采用 **"新中式"风格的扁平化或线性插画**。例如，用简洁的线条勾勒出祥云、竹叶、葫芦等具有吉祥寓意的传统元素。
    
- **健康运势模块：** 可在该卡片背景处，使用一幅淡雅的水墨风格插画，以突出其重要性。

**5. 颜色输出规范 (Color Output Specification)**

为确保前端准确渲染，AI模型在生成运势内容时，对于颜色相关输出应遵循以下规范：

- **幸运色输出格式：** `颜色名称 (Hex格式)`
  - 例如：`豆蔻绿 (#DCE9D5)`、`汝窑青 (#A2B8A6)`、`米白 (#F5F2ED)`
  - 
- **颜色描述要求：**
  - 提供中文颜色名称（如"豆沙绿"、"天青色"）
  - 同时提供对应的十六进制颜色代码（Hex格式）
  - 确保颜色名称与Hex代码的准确对应关系
  
- **前端渲染逻辑：**
  - 解析AI返回的颜色字符串，提取Hex代码用于实际渲染
  - 颜色名称用于展示给用户，增强文化体验感
  - 支持颜色渐变和透明度调整的扩展需求

**4. 动效与交互 (Animation & Interaction)**

- **加载动效：** 运势卡片可采用缓慢、优雅的 **渐显 (Fade in)** 或 **由下至上轻微浮入** 的效果，营造"揭晓"的仪式感。
    
- **评星动效：** 星星可以逐个点亮，增加趣味性。
    
- **无打扰交互：** 页面无弹窗、无广告，体验纯粹。

---

### **文档四：核心设计理念与架构优势**

**1. 核心设计理念：温暖的科技，东方的禅意**

我们的设计不应是冰冷的科技产品，而是一个有温度的每日问候。整体风格应融合现代科技的简洁清晰与东方文化的内敛雅致，营造一种"数字禅意"氛围。

- **关键词：** 关怀、健康、信赖、简洁、雅致、东方美学。

**2. 色彩搭配 (Color Palette)**

建议采用高饱和度、低亮度的"莫兰迪色系"或大地色系，给人以沉稳、舒适、不刺眼的视觉感受。

- **主色：** `豆蔻绿 (#DCE9D5)` 或 `汝窑青 (#A2B8A6)`，代表健康、自然、平和。
    
- **辅色：** `米白 (#F5F2ED)` 或 `暖沙色 (#EAE1D3)`，用作背景色，营造温暖、干净的视觉基底。
    
- **点缀色：** `秋柿橙 (#E58D52)` 或 `淡金色 (#D4AF37)`，用于重要按钮或评星，提亮画面。
    
- **文字色：** `深灰 (#3D403D)`，避免使用纯黑，显得更柔和、有亲和力。

**3. 前后端一体化的用户体验优势**

- **极速加载：** Server Components预渲染内容，首屏加载时间大幅缩短
    
- **无缝交互：** 前后端共享状态管理，页面切换流畅自然
    
- **离线友好：** 利用Next.js的缓存策略，提供更好的离线体验
    
- **SEO优化：** 服务端渲染确保搜索引擎友好，提升品牌曝光度

**4. 自有服务器部署的架构优势**

- **完全控制：** 拥有服务器完全控制权，可以根据业务需求灵活配置环境和资源
    
- **数据安全：** 所有用户数据和运势信息存储在自有服务器，确保数据隐私和安全性
    
- **成本可控：** 固定的服务器成本，不受用户访问量波动影响，长期运营成本更可预测
    
- **定制化部署：** 可以根据实际需求配置负载均衡、缓存策略、备份方案等
    
- **服务稳定性：** 不依赖第三方平台的服务可用性，避免外部服务故障影响业务
    
- **扩展灵活：** 可以根据业务发展需要，灵活扩展服务器资源和功能模块